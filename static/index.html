<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PicSync - Screenshot to Calendar</title>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@300;400;500;600;700&family=Google+Sans+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1976d2;
            --primary-dark: #1565c0;
            --secondary-color: #f57c00;
            --success-color: #388e3c;
            --error-color: #d32f2f;
            --warning-color: #f57c00;
            --background: #fafafa;
            --surface: #ffffff;
            --surface-variant: #f5f5f5;
            --on-surface: #1f1f1f;
            --on-surface-variant: #5f6368;
            --outline: #dadce0;
            --outline-variant: #e8eaed;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-hover: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background);
            color: var(--on-surface);
            line-height: 1.5;
            min-height: 100vh;
        }

        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--outline-variant);
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 500;
            color: var(--primary-color);
        }

        .logo .material-icons {
            font-size: 28px;
        }

        .tagline {
            color: var(--on-surface-variant);
            font-size: 14px;
            margin-left: auto;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 24px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 400;
            color: var(--on-surface);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 16px;
            color: var(--on-surface-variant);
            margin-bottom: 32px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--outline-variant);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
        }


        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .upload-icon {
            background: rgba(25, 118, 210, 0.1);
            color: var(--primary-color);
        }

        .clipboard-icon {
            background: rgba(245, 124, 0, 0.1);
            color: var(--secondary-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 500;
            color: var(--on-surface);
        }

        .card-description {
            color: var(--on-surface-variant);
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .upload-area {
            border: 2px dashed var(--outline);
            border-radius: 8px;
            padding: 32px 16px;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
            background: var(--surface-variant);
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(25, 118, 210, 0.04);
        }

        .upload-area .material-icons {
            font-size: 48px;
            color: var(--on-surface-variant);
            margin-bottom: 12px;
        }

        .upload-text {
            font-size: 16px;
            color: var(--on-surface);
            margin-bottom: 4px;
        }

        .upload-subtext {
            font-size: 14px;
            color: var(--on-surface-variant);
        }

        .file-input {
            display: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            min-height: 40px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            box-shadow: 0 2px 8px rgba(25, 118, 210, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--outline);
        }

        .btn-secondary:hover {
            background: rgba(25, 118, 210, 0.04);
            border-color: var(--primary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #2e7d32;
            box-shadow: 0 2px 8px rgba(56, 142, 60, 0.3);
        }

        .status-card {
            background: var(--surface);
            border: 1px solid var(--outline-variant);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
            display: none;
        }

        .status-card.loading {
            display: block;
            border-color: var(--primary-color);
        }

        .status-card.success {
            display: block;
            border-color: var(--success-color);
            background: rgba(56, 142, 60, 0.04);
        }

        .status-card.error {
            display: block;
            border-color: var(--error-color);
            background: rgba(211, 47, 47, 0.04);
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .loading .status-icon {
            background: var(--primary-color);
            color: white;
            animation: spin 1s linear infinite;
        }

        .success .status-icon {
            background: var(--success-color);
            color: white;
        }

        .error .status-icon {
            background: var(--error-color);
            color: white;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .status-title {
            font-size: 16px;
            font-weight: 500;
        }

        .loading .status-title {
            color: var(--primary-color);
        }

        .success .status-title {
            color: var(--success-color);
        }

        .error .status-title {
            color: var(--error-color);
        }

        .event-details {
            background: var(--surface);
            border: 1px solid var(--outline-variant);
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
        }

        .event-field {
            display: flex;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .event-field:last-child {
            margin-bottom: 0;
        }

        .event-label {
            font-weight: 500;
            color: var(--on-surface-variant);
            min-width: 80px;
            font-size: 14px;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .event-value {
            color: var(--on-surface);
            font-size: 14px;
            word-break: break-word;
        }

        .extracted-text {
            background: var(--surface-variant);
            border-radius: 6px;
            padding: 12px;
            font-family: 'Google Sans Mono', monospace;
            font-size: 12px;
            color: var(--on-surface-variant);
            margin: 16px 0;
            max-height: 120px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: rgba(25, 118, 210, 0.1);
            color: var(--primary-color);
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .chip.success {
            background: rgba(56, 142, 60, 0.1);
            color: var(--success-color);
        }

        .chip .material-icons {
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 24px 16px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .card {
                padding: 20px;
            }

            .page-title {
                font-size: 28px;
            }

            .header-content {
                padding: 0 16px;
            }

            .tagline {
                display: none;
            }

            .actions {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }
        }

        .footer {
            margin-top: 64px;
            padding: 24px;
            text-align: center;
            color: var(--on-surface-variant);
            font-size: 14px;
            border-top: 1px solid var(--outline-variant);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="material-icons">calendar_today</span>
                PicSync
            </div>
            <div class="tagline">Transform screenshots into calendar invites</div>
        </div>
    </header>

    <main class="main-container">
        <h1 class="page-title">Screenshot to Calendar</h1>
        <p class="page-subtitle">Upload a screenshot or paste from clipboard to automatically extract event details and create calendar invites.</p>

        <div class="cards-grid" id="uploadSection">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon upload-icon">
                        <span class="material-icons">add_photo_alternate</span>
                    </div>
                    <div class="card-title">Upload Screenshot</div>
                </div>
                <p class="card-description">
                    Drag and drop your screenshot, click to browse files, or paste from clipboard (Ctrl+V). Supports PNG, JPG, and GIF formats.
                </p>
                <div class="upload-area" id="uploadArea">
                    <span class="material-icons">add_photo_alternate</span>
                    <div class="upload-text">Drop screenshot here or paste from clipboard</div>
                    <div class="upload-subtext">or click to browse files</div>
                    <input type="file" class="file-input" id="fileInput" accept="image/*">
                </div>
                <div style="margin-top: 16px; display: flex; gap: 12px; align-items: center;">
                    <button class="btn btn-primary" id="uploadBtn">
                        <span class="material-icons">upload</span>
                        Choose File
                    </button>
                    <div class="chip">
                        <span class="material-icons">keyboard</span>
                        Ctrl+V to paste
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Status -->
        <div class="status-card loading" id="loadingCard" style="display: none;">
            <div class="status-header">
                <div class="status-icon">
                    <span class="material-icons">autorenew</span>
                </div>
                <div class="status-title">Processing Image</div>
            </div>
            <p>Extracting text and analyzing event details with AI...</p>
        </div>

        <!-- Success Status -->
        <div class="status-card success" id="successCard" style="display: none;">
            <div class="status-header">
                <div class="status-icon">
                    <span class="material-icons">check_circle</span>
                </div>
                <div class="status-title">Event Detected</div>
                <div class="chip success" style="margin-left: auto;">
                    <span class="material-icons">psychology</span>
                    AI Enhanced
                </div>
            </div>
            
            <div class="event-details" id="eventDetails">
                <!-- Event details will be populated here -->
            </div>


            <div class="actions">
                <a href="#" class="btn btn-success" id="calendarBtn" target="_blank">
                    <span class="material-icons">event</span>
                    Add to Google Calendar
                </a>
                <button class="btn btn-secondary" onclick="location.reload()">
                    <span class="material-icons">refresh</span>
                    Process Another
                </button>
            </div>
        </div>

        <!-- Error Status -->
        <div class="status-card error" id="errorCard" style="display: none;">
            <div class="status-header">
                <div class="status-icon">
                    <span class="material-icons">error</span>
                </div>
                <div class="status-title">Processing Failed</div>
            </div>
            <p id="errorMessage">An error occurred while processing your image.</p>
            <div class="actions">
                <button class="btn btn-primary" onclick="location.reload()">
                    <span class="material-icons">refresh</span>
                    Try Again
                </button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Powered by Google Cloud Vision API and Gemini AI • Built with FastAPI and Firebase</p>
    </footer>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const uploadSection = document.getElementById('uploadSection');
        const loadingCard = document.getElementById('loadingCard');
        const successCard = document.getElementById('successCard');
        const errorCard = document.getElementById('errorCard');
        const eventDetails = document.getElementById('eventDetails');
        const calendarBtn = document.getElementById('calendarBtn');
        const errorMessage = document.getElementById('errorMessage');

        // File upload handling
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadBtn.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Clipboard handling
        async function handleClipboardPaste() {
            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const clipboardItem of clipboardItems) {
                    for (const type of clipboardItem.types) {
                        if (type.startsWith('image/')) {
                            const blob = await clipboardItem.getType(type);
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                handleClipboardImage(e.target.result);
                            };
                            reader.readAsDataURL(blob);
                            return;
                        }
                    }
                }
                showError('No image found in clipboard');
            } catch (err) {
                showError('Unable to access clipboard. Please use the upload option instead.');
            }
        }

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showError('Please select an image file (PNG, JPG, or GIF)');
                return;
            }

            showLoading();
            
            const formData = new FormData();
            formData.append('file', file);

            fetch('/api/process-image', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.detail || 'Failed to process image');
                }
            })
            .catch(err => {
                hideLoading();
                showError('Network error. Please check your connection and try again.');
            });
        }

        function handleClipboardImage(dataUrl) {
            showLoading();
            
            fetch('/api/process-clipboard', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ image: dataUrl })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading();
                if (data.success) {
                    showResult(data);
                } else {
                    showError(data.detail || 'Failed to process image');
                }
            })
            .catch(err => {
                hideLoading();
                showError('Network error. Please check your connection and try again.');
            });
        }

        function showLoading() {
            hideAllCards();
            loadingCard.style.display = 'block';
        }

        function hideLoading() {
            loadingCard.style.display = 'none';
        }

        function showResult(data) {
            hideAllCards();
            
            const event = data.event;
            
            // Populate event details
            let detailsHtml = '';
            if (event.title) {
                detailsHtml += `<div class="event-field"><div class="event-label">Title</div><div class="event-value">${escapeHtml(event.title)}</div></div>`;
            }
            if (event.date) {
                detailsHtml += `<div class="event-field"><div class="event-label">Date</div><div class="event-value">${escapeHtml(event.date)}</div></div>`;
            }
            
            // Show time range if both start and end times are available
            if (event.start_time && event.end_time) {
                const timeRange = `${event.start_time} - ${event.end_time}`;
                detailsHtml += `<div class="event-field"><div class="event-label">Time</div><div class="event-value">${escapeHtml(timeRange)}</div></div>`;
            } else if (event.start_time) {
                detailsHtml += `<div class="event-field"><div class="event-label">Start Time</div><div class="event-value">${escapeHtml(event.start_time)}</div></div>`;
            } else if (event.time) {
                detailsHtml += `<div class="event-field"><div class="event-label">Time</div><div class="event-value">${escapeHtml(event.time)}</div></div>`;
            }
            
            if (event.timezone) {
                detailsHtml += `<div class="event-field"><div class="event-label">Timezone</div><div class="event-value">${escapeHtml(event.timezone)}</div></div>`;
            }
            if (event.duration) {
                detailsHtml += `<div class="event-field"><div class="event-label">Duration</div><div class="event-value">${escapeHtml(event.duration)}</div></div>`;
            }
            if (event.location) {
                detailsHtml += `<div class="event-field"><div class="event-label">Location</div><div class="event-value">${escapeHtml(event.location)}</div></div>`;
            }
            if (event.description) {
                detailsHtml += `<div class="event-field"><div class="event-label">Description</div><div class="event-value">${escapeHtml(event.description)}</div></div>`;
            }
            
            eventDetails.innerHTML = detailsHtml || '<div class="event-field"><div class="event-value">No event details could be extracted from the image.</div></div>';
            
            // Set calendar URL
            calendarBtn.href = data.calendar_url;
            
            successCard.style.display = 'block';
        }

        function showError(message) {
            hideAllCards();
            errorMessage.textContent = message;
            errorCard.style.display = 'block';
        }

        function hideAllCards() {
            uploadSection.style.display = 'none';
            loadingCard.style.display = 'none';
            successCard.style.display = 'none';
            errorCard.style.display = 'none';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'v') {
                e.preventDefault();
                handleClipboardPaste();
            }
        });
    </script>
</body>
</html>